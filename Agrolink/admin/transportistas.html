<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AgroLink - Gesti贸n de Transportistas</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="../css/Admin/transportistas.css" />
</head>

<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <i class="fas fa-truck"></i>
      <h1>AgroLink</h1>
    </div>
    <nav class="nav-menu">
      <a href="admin.html" class="nav-item"><i class="fas fa-home"></i><span>Dashboard</span></a>
      <a href="envios.html" class="nav-item"><i class="fas fa-truck"></i><span>Env铆os</span></a>
      <a href="transportistas.html" class="nav-item active"><i class="fas fa-users"></i><span>Transportistas</span></a>
      <a href="productos.html" class="nav-item"><i class="fas fa-box"></i><span>Productos</span></a>
      <a href="usuarios.html" class="nav-item"><i class="fas fa-user"></i><span>Usuarios</span></a>
      <a href="reportes.html" class="nav-item"><i class="fas fa-chart-bar"></i><span>Reportes</span></a>
      <a href="configuracion.html" class="nav-item"><i class="fas fa-cog"></i><span>Configuraci贸n</span></a>
      <a href="../index.html" class="nav-item logout" id="logout"><i class="fas fa-sign-out-alt"></i><span>Cerrar Sesi贸n</span></a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <header class="header">
      <div class="header-title">
        <i class="fas fa-users"></i>
        <h1>Gesti贸n de Transportistas</h1>
      </div>
      <div class="user-profile">
        <div class="avatar">A</div>
        <span class="username" id="adminName">Admin</span>
      </div>
    </header>

    <!-- Filtros -->
    <div class="search-filters">
      <h2>Filtros de b煤squeda</h2>
      <div class="filters-container">
        <div class="filter-input"><input type="text" placeholder="Nombre (Ej. Rodr铆guez)" id="filterNombre" /></div>
        <div class="filter-input">
          <select id="filterRegion">
            <option value="">Todas las regiones</option>
            <option value="Lima">Lima</option>
            <option value="Arequipa">Arequipa</option>
            <option value="Cusco">Cusco</option>
            <option value="Puno">Puno</option>
            <option value="Trujillo">Trujillo</option>
          </select>
        </div>
        <button class="filter-button" id="btnBuscar"><i class="fas fa-search"></i> Buscar</button>
      </div>
    </div>

    <!-- Tabla -->
    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>#</th>
            <th>Nombre</th>
            <th>Correo</th>
            <th>Placa</th>
            <th>Capacidad (kg)</th>
            <th>Cuenta Bancaria</th>
            <th>Licencia</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody id="transportistasTableBody"></tbody>
      </table>
    </div>
  </main>

  <script>
    // =============== VALIDACIN DE SESIN ===============
    document.addEventListener("DOMContentLoaded", () => {
      const usuarioActivo = JSON.parse(localStorage.getItem("agrolinkUsuario"));
      if (!usuarioActivo || usuarioActivo.rol !== "admin") {
        alert("锔 Acceso restringido. Solo los administradores pueden entrar aqu铆.");
        window.location.href = "../login.html";
        return;
      }

      document.getElementById("adminName").textContent = usuarioActivo.nombre || "Administrador";

      // =============== CARGAR TRANSPORTISTAS ===============
      const usuarios = JSON.parse(localStorage.getItem("agrolinkUsuarios")) || [];
      const transportistas = usuarios.filter(u => (u.rol || "").toLowerCase() === "transportista");

      const tbody = document.getElementById("transportistasTableBody");
      renderTabla(transportistas);

      function renderTabla(data) {
        tbody.innerHTML = "";
        if (data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="8" style="text-align:center;padding:2rem;">No hay transportistas registrados.</td></tr>`;
          return;
        }

        data.forEach((t, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${i + 1}</td>
            <td>${t.nombre || "-"}</td>
            <td>${t.email || "-"}</td>
            <td>${t.placa || "-"}</td>
            <td>${t.capacidad || "-"}</td>
            <td>${t.cuentaBancaria || "-"}</td>
            <td>${t.licencia || "-"}</td>
            <td><span class="status status-active">Activo</span></td>
          `;
          tbody.appendChild(row);
        });
      }

      // =============== FILTROS ===============
      document.getElementById("btnBuscar").addEventListener("click", () => {
        const nombreFiltro = document.getElementById("filterNombre").value.toLowerCase();
        const regionFiltro = document.getElementById("filterRegion").value;

        const filtrados = transportistas.filter(t => {
          const coincideNombre = !nombreFiltro || (t.nombre || "").toLowerCase().includes(nombreFiltro);
          const coincideRegion = !regionFiltro || (t.region || "") === regionFiltro;
          return coincideNombre && coincideRegion;
        });

        renderTabla(filtrados);
      });

      // =============== LOGOUT ===============
      document.getElementById("logout").addEventListener("click", () => {
        localStorage.removeItem("agrolinkUsuario");
        localStorage.removeItem("usuarioActivo");
        localStorage.removeItem("agrolinkRol");
        alert(" Sesi贸n cerrada correctamente.");
        window.location.href = "../index.html";
      });
    });
  </script>
</body>
</html>
