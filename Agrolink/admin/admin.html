<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AgroLink - Panel de Administración</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="../css/Admin/admin.css" />
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <i class="fas fa-truck"></i>
      <h1>AgroLink</h1>
    </div>
    <nav class="nav-menu">
      <a href="admin.html" class="nav-item active">
        <i class="fas fa-home"></i>
        <span>Dashboard</span>
      </a>
      <a href="envios.html" class="nav-item">
        <i class="fas fa-truck"></i>
        <span>Envíos</span>
      </a>
      <a href="transportistas.html" class="nav-item">
        <i class="fas fa-users"></i>
        <span>Transportistas</span>
      </a>
      <a href="productos.html" class="nav-item">
        <i class="fas fa-box"></i>
        <span>Productos</span>
      </a>
      <a href="usuarios.html" class="nav-item">
        <i class="fas fa-user"></i>
        <span>Usuarios</span>
      </a>
      <a href="reportes.html" class="nav-item">
        <i class="fas fa-chart-bar"></i>
        <span>Reportes</span>
      </a>
      <a href="configuracion.html" class="nav-item">
        <i class="fas fa-cog"></i>
        <span>Configuración</span>
      </a>
      <a href="../index.html" class="nav-item logout">
        <i class="fas fa-sign-out-alt"></i>
        <span>Cerrar Sesión</span>
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="header">
      <div class="header-title">
        <i class="fas fa-truck"></i>
        <h1>AgroLink Admin</h1>
      </div>
      <div class="user-profile">
        <div class="avatar">A</div>
        <span class="username">Admin</span>
      </div>
    </header>

    <!-- Dashboard Card -->
    <div class="dashboard-card">
      <h2>Panel de Control</h2>
      <p>Gestión centralizada de envíos, transportistas y productos.</p>
    </div>

    <!-- Stats -->
    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-value" id="totalEnvios">0</div>
        <div class="stat-label">Envíos Totales</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="enviosPendientes">0</div>
        <div class="stat-label">Pendientes</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="enviosEntregados">0</div>
        <div class="stat-label">Entregados</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalTransportistas">0</div>
        <div class="stat-label">Transportistas</div>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="recent-activity">
      <h2>Actividad Reciente</h2>
      <ul class="activity-list" id="activityList">
        <li class="activity-item"><i class="fas fa-truck"></i> Nuevo envío SHP-2025-004 registrado.</li>
        <li class="activity-item"><i class="fas fa-user"></i> Usuario "Juan Pérez" agregado.</li>
        <li class="activity-item"><i class="fas fa-box"></i> Producto "Maíz" actualizado.</li>
      </ul>
    </div>
  </main>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // === FUNCIONES DE LECTURA ===
    function getSolicitudes() {
      return JSON.parse(localStorage.getItem("solicitudesAgroLink") || "[]");
    }

    function getUsuarios() {
      return JSON.parse(localStorage.getItem("agrolinkUsuarios") || "[]");
    }

    // === ACTUALIZAR ESTADÍSTICAS ===
    function actualizarEstadisticas() {
      const solicitudes = getSolicitudes();
      const usuarios = getUsuarios();

      // Filtrar transportistas
      const transportistas = usuarios.filter(u => u.rol === "transportista");

      // KPIs
      const totalEnvios = solicitudes.length;
      const pendientes = solicitudes.filter(s => /Pendiente/i.test(s.estado || "")).length;
      const entregados = solicitudes.filter(s => /Completado|Entregado/i.test(s.estado || "")).length;
      const totalTransportistas = transportistas.length;

      // Mostrar en pantalla
      document.getElementById("totalEnvios").textContent = totalEnvios;
      document.getElementById("enviosPendientes").textContent = pendientes;
      document.getElementById("enviosEntregados").textContent = entregados;
      document.getElementById("totalTransportistas").textContent = totalTransportistas;

      // === ACTUALIZAR ACTIVIDAD RECIENTE ===
      const activityList = document.getElementById("activityList");
      activityList.innerHTML = "";

      // Tomar últimas 5 actividades (orden inverso)
      const recientes = solicitudes.slice(-5).reverse();

      if (recientes.length === 0) {
        activityList.innerHTML = `<li class="activity-item"><i class="fas fa-info-circle"></i> No hay actividad reciente registrada.</li>`;
      } else {
        recientes.forEach(s => {
          const estadoIcono =
            /Pendiente/i.test(s.estado)
              ? "fa-clock text-warning"
              : /En curso/i.test(s.estado)
              ? "fa-truck text-primary"
              : /Completado|Entregado/i.test(s.estado)
              ? "fa-circle-check text-success"
              : "fa-box";

          const li = document.createElement("li");
          li.classList.add("activity-item");
          li.innerHTML = `
            <i class="fas ${estadoIcono}"></i>
            <strong>${s.tipo || "Transporte"}</strong> ${s.id ? `(${s.id})` : ""}
            — ${s.origen || "?"} → ${s.destino || "?"}
            <small style="color:#6b7280;"> (${s.estado || "Sin estado"})</small>
          `;
          activityList.appendChild(li);
        });
      }
    }

    // === INICIALIZACIÓN ===
    actualizarEstadisticas();
  });
</script>

</body>
</html>